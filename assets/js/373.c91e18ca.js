(window.webpackJsonp=window.webpackJsonp||[]).push([[373],{451:function(e,t,a){"use strict";a.r(t);var s=a(38),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticStyle:{"font-size":"0.9em","margin-bottom":"-20px"}},[a("a",{attrs:{href:"/books/api-security/sanitizing/"}},[e._v("‚Üê Sanitizing Data")])]),e._v(" "),a("h2",{attrs:{id:"sanitizing-common-attacks"}},[e._v("Common Attacks "),a("a",{staticClass:"header-anchor header-link",attrs:{href:"#sanitizing-common-attacks"}},[a("svg",{attrs:{viewBox:"0 0 512 512"}},[a("path",{attrs:{fill:"currentColor",d:"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"}})])])]),e._v(" "),a("p",[e._v("The examples in this chapter have discussed ways to validate inputs but have only hinted at the type of attacks used when inputs are not properly sanitized. Let's look at those potential attacks, and how to prevent them, now.")]),e._v(" "),a("h3",{attrs:{id:"sql-injection-attacks"}},[e._v("SQL Injection Attacks "),a("a",{staticClass:"header-anchor header-link",attrs:{href:"#sql-injection-attacks"}},[a("svg",{attrs:{viewBox:"0 0 512 512"}},[a("path",{attrs:{fill:"currentColor",d:"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"}})])])]),e._v(" "),a("p",[e._v("SQL injection is by far the most common form of data sanitization attack, and remains number one in the "),a("a",{attrs:{href:"https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("OWASP Top 10"),a("OutboundLink")],1),e._v(" (a popular list of the most commonly found and exploited software vulnerabilities). It's held the number one spot for over 10 years now.")]),e._v(" "),a("p",[e._v("SQL injection occurs when an attacker is able to query or modify a database due to poor input sanitization. Other query injection attacks are similar, as most are typically a result of string concatenation.  In the following example, a simple user query string is built with concatenation.")]),e._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[e._v("userId "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" getFromInput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"userId"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("sql")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"SELECT * FROM Users WHERE UserId = "')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" userId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("If the "),a("code",[e._v("userId")]),e._v(" were "),a("code",[e._v("jcoder")]),e._v(" the SQL query would be "),a("code",[e._v('"SELECT * FROM Users WHERE UserId = jcoder')]),e._v(", however, a malicious attacker might input "),a("code",[e._v("jcoder; DROP TABLE ImportantStuff")]),e._v(" which would result in two statements being executed:")]),e._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" Users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WHERE")]),e._v(" UserId "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" jcoder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DROP")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" ImportantStuff\n")])])]),a("p",[e._v("Similarly, the user could enter "),a("code",[e._v("jcoder OR 1=1")]),e._v(" which would query for a user with the ID of "),a("code",[e._v("jcoder")]),e._v(" OR "),a("code",[e._v("true")]),e._v(" ("),a("code",[e._v("1=1")]),e._v(" is always true), this would return all of the users in the system.")]),e._v(" "),a("p",[e._v("The cause of this issue is the use of poor string concatenation.  In the example above, the value of the "),a("code",[e._v("userId")]),e._v(" input crosses a trust boundary and ends up getting executed. The best way around this is to use SQL prepared statements.  The syntax for using prepared statements varies from language to language but the gist is that the above query would become "),a("code",[e._v("SELECT * FROM Users WHERE UserId = ?")]),e._v(".  The question mark would be replaced with the input value and be evaluated as a string instead of changing the query itself.")]),e._v(" "),a("p",[e._v("Most web frameworks and ORM libraries provide tools to protect against SQL injection attacks, be sure to look through your developer library documentation to ensure you're using these tools properly.")]),e._v(" "),a("h3",{attrs:{id:"xss-cross-site-scripting"}},[e._v("XSS - Cross Site Scripting "),a("a",{staticClass:"header-anchor header-link",attrs:{href:"#xss-cross-site-scripting"}},[a("svg",{attrs:{viewBox:"0 0 512 512"}},[a("path",{attrs:{fill:"currentColor",d:"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"}})])])]),e._v(" "),a("p",[e._v("A cross-site scripting attack (XSS) is an attack that executes code in a web page viewed by a user. There are three different types of XSS attacks:")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("Stored XSS")]),e._v(" - A persisted (in a database, log, etc) payload is rendered to an HTML page. For example, content on an forum.")]),e._v(" "),a("li",[a("strong",[e._v("Reflected XSS")]),e._v(" - Attack payload is submitted by a user, the rendered server response contains the executed code. This differs from Stored XSS where as the attack payload is not persisted, but instead delivered as part of the request, eg. a link: "),a("code",[e._v("http://example.com/login?userId=<script>alert(document.cookie)<\/script>")])]),e._v(" "),a("li",[a("strong",[e._v("DOM based XSS")]),e._v(" - The attack payload is executed as the result of an HTML page's DOM changing. With DOM based XSS the attack payload may not leave the victim's browser. The client side JavaScript is exploited.")])]),e._v(" "),a("p",[e._v("There are "),a("a",{attrs:{href:"https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29",target:"_blank",rel:"noopener noreferrer"}},[e._v("tons of resources online"),a("OutboundLink")],1),e._v(" that cover this topic in great detail, so I'll only provide a basic example here. Earlier in this chapter the string "),a("code",[e._v("<img src onerror='alert(\"haxor\")'>")]),e._v(" was posted as a Reddit comment. If this string isn't correctly escaped it would have resulted in an annoying popup, shown in "),a("a",{staticClass:"figref",attrs:{href:"#fig_sanitizing_alert"}}),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/books/api-security/sanitizing/images/alert.png",alt:"A JavaScript alert popup",title:"A JavaScript alert popup"}})]),e._v(" "),a("p",[e._v("You may see "),a("code",[e._v("alert()")]),e._v(" used throughout examples when describing these attacks. The idea is if you can cause an alert to happen in the browser, you can execute other code that does something more malicious like sends your information (cookie, session ID, or other personal info) to a remote site.")]),e._v(" "),a("h3",{attrs:{id:"file-upload-attacks"}},[e._v("File upload attacks "),a("a",{staticClass:"header-anchor header-link",attrs:{href:"#file-upload-attacks"}},[a("svg",{attrs:{viewBox:"0 0 512 512"}},[a("path",{attrs:{fill:"currentColor",d:"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"}})])])]),e._v(" "),a("p",[e._v("It is common for sites to support file uploads, particularly images such as profile avatars or photos. When uploading files, it is necessary to validate the type, size, and contents of these files.  For example, if a user is uploading an avatar image, it's important to ensure the newly uploaded file is actually an image.")]),e._v(" "),a("p",[e._v("If an attacker can upload a PHP file named "),a("code",[e._v("avatar.php")]),e._v(" instead of an image file, then later retrieve the file, unexpected and disastrous behavior may occur. Imagine what would happen if that file is executed on the server, you could have a remote code exploit on your hands. There are a few things you can do to prevent this type of attack:")]),e._v(" "),a("p",[e._v("Validate expected file types\nCheck that file size is reasonable (if someone is uploading a 1GB image, you might have a problem)\nIf storing the file to disk, do NOT use a user input field as part of the file name, eg: "),a("code",[e._v("../../../etc/config.file")]),e._v("\nAlways serve the files with the correct Content-Type header (image/png, audio/mpeg)\nRun a virus scan on all uploaded files\nDo not allow uploads of web executed files: php, cgi, js, swf, etc.\nProcess the files - rename, resize, remove exif data, etc - before displaying back to the user")])])}),[],!1,null,null,null);t.default=r.exports}}]);